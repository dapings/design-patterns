# 工厂模式

## 如何解耦复杂对象的创建和使用

简单工厂模式和工厂方法模式比较简单，在实际的项目开发中常用；抽象工厂模式的原理比较复杂，在实际项目开发中，并不常用，简单了解。

工厂类型只负责对象的创建，让其职责单一、代码清晰，并将功能独立的代码块封装成函数。

简单工厂模式，没有工厂接口定义及实现；工厂方法模式，创建的类型对象，无关联性。

工厂方法模式比简单工厂模式更加符合开闭原则。

拆分解耦的目的是降低代码的复杂度，如果代码已经足够简单，就没有必要继续拆分了，避免过度设计。使用工厂方法模式，将复杂的创建逻辑拆分到多个工厂类型中，这样可以保证每个工厂类型都不会过于复杂。

实际上，工厂方法模式是基于简单工厂模式，对对象创建逻辑的进一步拆分。

在简单工厂模式和工厂方法模式中，类型人有一种分类方式，如果有多种分类方式，使用抽象工厂模式，让一个工厂负责创建多种不同类型的对象，而不是只创建一种类型的对象，可以有效地减少工厂类型的个数。

### 简单工厂模式

简单工厂模式还称为静态工厂方法模式，因为其中的创建对象的方法是静态的。

Go 语言，没有类、构造函数，通常使用`type`定义接口等类型，`NewX` 进行初始化，封装一些实现细节。

`NewX` 函数返回接口类型时，就时简单工厂模式，但每次调用`NewRuleConfigParser`都会创建一个新的 `Parser`，应当复用并缓存，见 `RuleConfigParserFactory`.

### 工厂方法模式

工厂方法模式，生成的类型对象无关联性，使用子类型对象的方式，延迟生成对象到子类型对象中实现。

Go 语言中不存在继承，所以使用匿名组合的方式实现。

如果引入工厂方法模式，让设计变得更加复杂了，可以为工厂类型再创建一个简单工厂，也就是工厂的工厂，用来创建工厂类型的对象。

### 抽象工厂模式

抽象工厂模式，用于生成产品族的工厂，所生成的对象是有关联性的。如果抽象工厂退化成生成的对象无关联性，则成为工厂方法模式。

如例子中使用 `RDB`, `XML` 存储订单信息，抽象工厂分别能生成相关的主订单信息和订单详情信息。如果业务逻辑中，需要替换使用的存储，则只需要改动工厂方法相关的类，就能替换使用不同的存储方式了。

## 应用场景总结

当对象的创建逻辑比较复杂时，考虑使用工厂模式，封装对象的创建过程，将对象的创建和使用分离，降低代码的复杂度。

当每个对象的创建逻辑都比较简单时，使用简单工厂模式，将多个对象的创建逻辑放到一个工厂类型中即可。

当每个对象的创建逻辑都比较复杂时，为了避免工厂类型过于复杂，推荐使用工厂方法模式，将对象的创建逻辑拆分得更细，每个对象的创建逻辑单独放到各自的工厂类中。

总结一下，工厂模式的作用有下列 4 个，也是判断是否使用工厂模式的参考标准：

1. 封装变化：利用工厂模式，封装创建逻辑，创建逻辑的变更对调用者透明。
2. 代码复用：创建逻辑抽离到工厂类型中，不需要重复编写。
3. 隔离复杂度：封装复杂的创建逻辑，调用者无须了解如何创建对象。
4. 控制复杂度：将创建逻辑与使用逻辑分离，原本复杂的代码变得简单。